# 수집 주기 검토 — 팀 논의용

> **작성일**: 2026-02-26
> **목적**: 현재 Monitor.json 수집 주기의 적절성 검토 및 최적 주기 합의
> **결정**: 2026-02-26 — **B안 + TopN=10** 채택, Monitor.json 반영 완료

---

## 1. 현황

### 현재 설정 (conf/ResourceAgent/Monitor.json)

| Collector | 현재 주기 | Rows/Cycle | Rows/Day | 비중 |
|-----------|----------|------------|----------|------|
| cpu | 10s | 1 | 8,640 | 5.1% |
| memory | 10s | 3 | 25,920 | 15.3% |
| network | 10s | 4 | 34,560 | **20.3%** |
| cpu_process | 30s | 10 | 28,800 | **16.9%** |
| memory_process | 30s | 10 | 28,800 | **16.9%** |
| disk | 30s | 2 | 5,760 | 3.4% |
| temperature | 30s | 3 | 8,640 | 5.1% |
| fan | 30s | 2 | 5,760 | 3.4% |
| voltage | 30s | 3 | 8,640 | 5.1% |
| motherboard_temp | 30s | 2 | 5,760 | 3.4% |
| gpu | 30s | 0 | 0 | 0% |
| storage_smart | 60s | 6 | 8,640 | 5.1% |
| **합계** | | **118/min** | **169,920** | **100%** |

### 데이터 규모 (현재 기준)

| | 1 PC | 1,000대 | 10,000대 |
|--|------|---------|----------|
| 일일 Document | 170K | 170M | **1.7B** |
| 일일 ES 용량 | 69 MB | 67 GB | **672 GB** |
| 월간 ES 용량 | 2.0 GB | 2.0 TB | **20.1 TB** |

---

## 2. 논의 포인트

### [논의 1] 10초 주기 — cpu, memory, network

**현재**: 10초 → 3개 수집기가 전체 데이터량의 **40.7%** 차지

| 질문 | 고려사항 |
|------|---------|
| 10초 단위 변화를 실시간 감시하는 대시보드가 있는가? | 없다면 30초로도 충분 |
| 이상 감지 알람 기준이 10초 단위인가? | 대부분의 모니터링 시스템은 1분 이상 지속 시 알람 |
| 공장 라인 설비에서 CPU/Memory가 10초 내 급변하는 케이스가 있는가? | 일반적으로 30초~1분 추이로 판단 |

**선택지**:

| 옵션 | 주기 | Rows/Day 변화 | 비고 |
|------|------|---------------|------|
| 유지 | 10s | 0 | 실시간 대시보드 필요 시 |
| **30s (권장)** | 30s | **-46,080 (-27.1%)** | 대부분의 모니터링 표준 |
| 60s | 60s | **-57,600 (-33.9%)** | 추이 분석만 필요 시 |

### [논의 2] Process 수집 — cpu_process, memory_process

**현재**: TopN=10, 30초 → 2개 합계 전체의 **33.8%** 차지 (최대 비중)

| 질문 | 고려사항 |
|------|---------|
| Top 10이 꼭 필요한가? Top 5로도 이상 프로세스 감지 가능한가? | Top 3~5면 대부분 커버 |
| 30초마다 전체 프로세스 스캔이 필요한가? | 프로세스 순위는 분 단위로 변동 |
| 프로세스별 데이터를 ES에서 실제로 조회하는 빈도는? | 사후 분석용이면 60s~120s 가능 |

**선택지**:

| 옵션 | TopN | 주기 | Rows/Day 변화 | 비고 |
|------|------|------|---------------|------|
| 유지 | 10 | 30s | 0 | |
| TopN 축소 | **5** | 30s | **-28,800 (-16.9%)** | 상위 프로세스 5개면 충분 시 |
| 주기 연장 | 10 | **60s** | **-28,800 (-16.9%)** | 추이 분석용 |
| **양쪽 조정 (권장)** | **5** | **60s** | **-43,200 (-25.4%)** | 사후 분석 + 이상 감지 |

### [논의 3] 하드웨어 센서 — temperature, fan, voltage, motherboard_temp

**현재**: 전부 30초 → 4개 합계 전체의 **16.9%**

| 질문 | 고려사항 |
|------|---------|
| 온도/팬/전압이 30초 내 급변하는 시나리오가 있는가? | 열 관성 → 보통 분 단위 변동 |
| 알람 기준이 30초 단위 변화인가? | 대부분 수 분 지속 시 알람 |
| 공장 환경에서 voltage 모니터링이 얼마나 중요한가? | 전원 이상은 드문 이벤트 |

**선택지**:

| 옵션 | 주기 | Rows/Day 변화 | 비고 |
|------|------|---------------|------|
| 유지 | 30s | 0 | |
| **60s (권장)** | 60s | **-14,400 (-8.5%)** | 하드웨어는 느리게 변함 |
| 120s | 120s | **-21,600 (-12.7%)** | 추이만 보면 충분 시 |

### [논의 4] Storage SMART

**현재**: 60초 → 전체의 **5.1%**

| 질문 | 고려사항 |
|------|---------|
| SMART 값이 60초마다 변하는가? | **아니오** — 시간/일 단위로 변동하는 지표 |
| power_on_hours, power_cycles가 1분마다 필요한가? | remaining_life는 하루 단위로도 충분 |
| 업계 표준 SMART 수집 주기는? | 5분~1시간이 일반적 |

**선택지**:

| 옵션 | 주기 | Rows/Day 변화 | 비고 |
|------|------|---------------|------|
| 유지 | 60s | 0 | |
| **300s (권장)** | 5분 | **-6,912 (-4.1%)** | 업계 일반 수준 |
| 600s | 10분 | **-7,776 (-4.6%)** | |
| 3600s | 1시간 | **-8,400 (-4.9%)** | 일일 리포트 목적 |

### [논의 5] disk

**현재**: 30초 → 전체의 **3.4%**

| 질문 | 고려사항 |
|------|---------|
| 디스크 사용률이 30초마다 유의미하게 변하는가? | 대용량 파일 생성 시에만 |
| 디스크 Full 알람의 긴급성은? | 보통 80%~90% 임계치, 분 단위면 충분 |

**선택지**:

| 옵션 | 주기 | Rows/Day 변화 | 비고 |
|------|------|---------------|------|
| 유지 | 30s | 0 | |
| **60s (권장)** | 60s | **-2,880 (-1.7%)** | |
| 120s | 120s | **-4,320 (-2.5%)** | |

---

## 3. 시나리오별 비교

### 시나리오 정의

| | 현재 | A: 보수적 | B: 권장 | C: 경량 |
|--|------|----------|---------|---------|
| cpu, memory, network | 10s | **30s** | **30s** | **60s** |
| cpu_process | 30s / Top10 | 30s / Top10 | **60s / Top5** | **60s / Top5** |
| memory_process | 30s / Top10 | 30s / Top10 | **60s / Top5** | **60s / Top5** |
| disk | 30s | 30s | **60s** | **120s** |
| temperature | 30s | 30s | **60s** | **60s** |
| fan, voltage, mb_temp | 30s | 30s | **60s** | **120s** |
| storage_smart | 60s | **300s** | **300s** | **600s** |

### 데이터량 비교 (1 PC, 하루)

| 시나리오 | Rows/Min | Rows/Day | 일일 용량 | 절감률 |
|----------|----------|----------|-----------|--------|
| **현재** | 118 | 169,920 | 69 MB | — |
| **A: 보수적** | 72 | 103,680 | 42 MB | **-39%** |
| **B: 권장** | 42 | 60,480 | 25 MB | **-64%** |
| **C: 경량** | 27 | 38,880 | 16 MB | **-77%** |

### 10,000대 규모 영향

| 시나리오 | 일일 ES 용량 | 월간 ES 용량 | 7일 보존 디스크 (replica 포함) |
|----------|-------------|-------------|-------------------------------|
| **현재** | 672 GB | 20.1 TB | 11.3 TB |
| **A: 보수적** | 410 GB | 12.3 TB | 6.9 TB |
| **B: 권장** | 242 GB | 7.3 TB | **4.1 TB** |
| **C: 경량** | 155 GB | 4.7 TB | 2.6 TB |

### 초당 인덱싱 속도 (10,000대)

| 시나리오 | Docs/Sec | ES 노드 권장 |
|----------|----------|-------------|
| **현재** | ~19,700 | 5+ 노드 |
| **A: 보수적** | ~12,000 | 3+ 노드 |
| **B: 권장** | ~7,000 | **3 노드** |
| **C: 경량** | ~4,500 | 3 노드 (여유) |

---

## 4. 시나리오 B (권장안) 상세

### Monitor.json 변경안

```json
{
  "Collectors": {
    "cpu":              { "Enabled": true, "Interval": "30s" },
    "memory":           { "Enabled": true, "Interval": "30s" },
    "network":          { "Enabled": true, "Interval": "30s" },
    "disk":             { "Enabled": true, "Interval": "60s" },
    "temperature":      { "Enabled": true, "Interval": "60s" },
    "cpu_process":      { "Enabled": true, "Interval": "60s", "TopN": 5 },
    "memory_process":   { "Enabled": true, "Interval": "60s", "TopN": 5 },
    "fan":              { "Enabled": true, "Interval": "60s" },
    "gpu":              { "Enabled": true, "Interval": "60s" },
    "voltage":          { "Enabled": true, "Interval": "60s" },
    "motherboard_temp": { "Enabled": true, "Interval": "60s" },
    "storage_smart":    { "Enabled": true, "Interval": "300s" }
  }
}
```

### 권장안 Collector별 상세

| Collector | 주기 | Rows/Cycle | Rows/Min | Rows/Day | 비중 |
|-----------|------|------------|----------|----------|------|
| cpu | 30s | 1 | 2 | 2,880 | 4.8% |
| memory | 30s | 3 | 6 | 8,640 | 14.3% |
| network | 30s | 4 | 8 | 11,520 | 19.0% |
| disk | 60s | 2 | 2 | 2,880 | 4.8% |
| temperature | 60s | 3 | 3 | 4,320 | 7.1% |
| cpu_process | 60s | 5 | 5 | 7,200 | 11.9% |
| memory_process | 60s | 5 | 5 | 7,200 | 11.9% |
| fan | 60s | 2 | 2 | 2,880 | 4.8% |
| gpu | 60s | 0 | 0 | 0 | 0% |
| voltage | 60s | 3 | 3 | 4,320 | 7.1% |
| motherboard_temp | 60s | 2 | 2 | 2,880 | 4.8% |
| storage_smart | 300s | 6 | 1.2 | 1,728 | 2.9% |
| **합계** | | | **~42** | **~60,480** | **100%** |

### 현재 대비 변화

| 항목 | 현재 | 권장안 | 변화 |
|------|------|--------|------|
| Rows/Min | 118 | 42 | **-64%** |
| 일일 용량 (1 PC) | 69 MB | 25 MB | **-44 MB** |
| 일일 용량 (10,000대) | 672 GB | 242 GB | **-430 GB** |
| 월간 용량 (10,000대) | 20.1 TB | 7.3 TB | **-12.8 TB** |
| PC 리소스 영향 | 0.2% CPU | ~0.15% CPU | 미미 |

---

## 5. 결론 및 합의 필요 사항

| # | 합의 필요 항목 | 선택지 |
|---|---------------|--------|
| 1 | cpu/memory/network 주기 | 10s / **30s** / 60s |
| 2 | cpu_process/memory_process TopN | **5** / 10 |
| 3 | cpu_process/memory_process 주기 | 30s / **60s** |
| 4 | 하드웨어 센서류 주기 | 30s / **60s** / 120s |
| 5 | storage_smart 주기 | 60s / **300s** / 600s |
| 6 | disk 주기 | 30s / **60s** / 120s |

> **참고**: 수집 주기는 `conf/ResourceAgent/Monitor.json`의 Hot Reload로 서비스 재시작 없이 변경 가능합니다. 우선 보수적(A)으로 적용 후 운영 데이터를 보고 추가 조정하는 방법도 있습니다.
